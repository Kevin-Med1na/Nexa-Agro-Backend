generator client {
  provider        = "prisma-client-js"
  output          = "../src/generated/prisma"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
}

model actividad_mapeador {
  id_actividad         Int                  @id @default(autoincrement())
  id_perfil            Int
  periodo              DateTime             @db.Date
  total_reportes       Int                  @default(0)
  reportes_vigentes    Int                  @default(0)
  beneficio_activo     Boolean              @default(true)
  fecha_evaluacion     DateTime             @default(now()) @db.Timestamp(6)
  perfil_transportista perfil_transportista @relation(fields: [id_perfil], references: [id_perfil], onDelete: NoAction, onUpdate: NoAction)

  @@unique([id_perfil, periodo])
  @@index([beneficio_activo], map: "idx_actividad_beneficio")
  @@index([id_perfil], map: "idx_actividad_perfil")
  @@index([periodo(sort: Desc)], map: "idx_actividad_periodo")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model calificacion {
  id_calificacion                              Int         @id @default(autoincrement())
  id_transaccion                               Int
  id_calificador                               Int
  id_calificado                                Int
  rol_calificado                               String      @db.VarChar(20)
  puntaje                                      Int         @db.SmallInt
  comentario                                   String?
  fecha_calificacion                           DateTime    @default(now()) @db.Timestamp(6)
  usuario_calificacion_id_calificadoTousuario  usuario     @relation("calificacion_id_calificadoTousuario", fields: [id_calificado], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
  usuario_calificacion_id_calificadorTousuario usuario     @relation("calificacion_id_calificadorTousuario", fields: [id_calificador], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
  transaccion                                  transaccion @relation(fields: [id_transaccion], references: [id_transaccion], onDelete: NoAction, onUpdate: NoAction)

  @@unique([id_transaccion, id_calificador, id_calificado])
  @@index([id_calificado], map: "idx_calif_calificado")
  @@index([puntaje], map: "idx_calif_puntaje")
  @@index([id_transaccion], map: "idx_calif_transaccion")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model necesidad {
  id_necesidad     Int                @id @default(autoincrement())
  id_usuario       Int
  descripcion      String
  tipo             String?            @db.VarChar(100)
  cantidad         Int?
  unidad_medida    String?            @db.VarChar(50)
  precio_max       Decimal?           @db.Decimal(12, 2)
  fecha_registro   DateTime           @default(now()) @db.Timestamp(6)
  fecha_limite     DateTime?          @db.Timestamp(6)
  estado           String             @default("abierta") @db.VarChar(20)
  usuario          usuario            @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
  necesidad_oferta necesidad_oferta[]

  @@index([estado], map: "idx_necesidad_estado")
  @@index([fecha_limite], map: "idx_necesidad_limite")
  @@index([id_usuario], map: "idx_necesidad_usuario")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model necesidad_oferta {
  id_necesidad_oferta Int           @id @default(autoincrement())
  id_necesidad        Int
  id_producto         Int
  cantidad_ofertada   Int
  precio_ofertado     Decimal       @db.Decimal(12, 2)
  mensaje             String?
  estado              String        @default("pendiente") @db.VarChar(20)
  fecha_oferta        DateTime      @default(now()) @db.Timestamp(6)
  fecha_respuesta     DateTime?     @db.Timestamp(6)
  necesidad           necesidad     @relation(fields: [id_necesidad], references: [id_necesidad], onDelete: NoAction, onUpdate: NoAction)
  producto            producto      @relation(fields: [id_producto], references: [id_producto], onDelete: NoAction, onUpdate: NoAction)
  transaccion         transaccion[]

  @@unique([id_necesidad, id_producto])
  @@index([estado], map: "idx_noferta_estado")
  @@index([id_necesidad], map: "idx_noferta_necesidad")
  @@index([id_producto], map: "idx_noferta_producto")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model notificacion {
  id_notificacion  Int       @id @default(autoincrement())
  id_usuario       Int
  tipo             String    @db.VarChar(40)
  titulo           String    @db.VarChar(150)
  mensaje          String?
  id_referencia    Int?
  tabla_referencia String?   @db.VarChar(50)
  leida            Boolean   @default(false)
  fecha_creacion   DateTime  @default(now()) @db.Timestamp(6)
  fecha_lectura    DateTime? @db.Timestamp(6)
  usuario          usuario   @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)

  @@index([fecha_creacion(sort: Desc)], map: "idx_notif_fecha")
  @@index([leida], map: "idx_notif_leida")
  @@index([tipo], map: "idx_notif_tipo")
  @@index([id_usuario], map: "idx_notif_usuario")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model pago_suscripcion {
  id_pago        Int         @id @default(autoincrement())
  id_usuario     Int
  id_suscripcion Int
  monto          Decimal     @db.Decimal(10, 2)
  fecha_pago     DateTime    @default(now()) @db.Timestamp(6)
  fecha_inicio   DateTime    @db.Date
  fecha_fin      DateTime    @db.Date
  metodo_pago    String?     @db.VarChar(50)
  referencia     String?     @unique @db.VarChar(100)
  estado         String      @default("pendiente") @db.VarChar(20)
  suscripcion    suscripcion @relation(fields: [id_suscripcion], references: [id_suscripcion], onDelete: NoAction, onUpdate: NoAction)
  usuario        usuario     @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)

  @@index([estado], map: "idx_pago_estado")
  @@index([fecha_inicio, fecha_fin], map: "idx_pago_periodo")
  @@index([id_usuario], map: "idx_pago_usuario")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model perfil_transportista {
  id_perfil              Int                      @id @default(autoincrement())
  id_usuario             Int                      @unique
  rol                    String                   @db.VarChar(20)
  tipo                   String                   @db.VarChar(30)
  empresa_nombre         String?                  @db.VarChar(100)
  verificado             Boolean                  @default(false)
  fecha_verificacion     DateTime?                @db.Timestamp(6)
  cobertura_desc         String?                  @db.VarChar(200)
  activo                 Boolean                  @default(true)
  actividad_mapeador     actividad_mapeador[]
  usuario                usuario                  @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
  rutas                  rutas[]
  vehiculo_transportista vehiculo_transportista[]

  @@index([rol], map: "idx_perfil_rol")
  @@index([id_usuario], map: "idx_perfil_usuario")
  @@index([verificado], map: "idx_perfil_verificado")
}

model permiso_suscripcion {
  id_permiso     Int         @id @default(autoincrement())
  id_suscripcion Int
  codigo_permiso String      @db.VarChar(60)
  descripcion    String?
  suscripcion    suscripcion @relation(fields: [id_suscripcion], references: [id_suscripcion], onDelete: NoAction, onUpdate: NoAction)

  @@unique([id_suscripcion, codigo_permiso])
  @@index([codigo_permiso], map: "idx_permiso_codigo")
  @@index([id_suscripcion], map: "idx_permiso_sus")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model producto {
  id_producto           Int                     @id @default(autoincrement())
  id_usuario            Int
  id_ubicacion          Int?
  nombre                String                  @db.VarChar(100)
  tipo                  String                  @db.VarChar(50)
  descripcion           String?
  precio                Decimal                 @db.Decimal(12, 2)
  unidad_medida         String?                 @db.VarChar(50)
  stock                 Int                     @default(0)
  fecha_publicacion     DateTime                @default(now()) @db.Timestamp(6)
  disponible            Boolean                 @default(true)
  necesidad_oferta      necesidad_oferta[]
  ubicacion             ubicacion?              @relation(fields: [id_ubicacion], references: [id_ubicacion], onDelete: NoAction, onUpdate: NoAction)
  usuario               usuario                 @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
  publicidad_producto   publicidad_producto[]
  snapshot_mapa         snapshot_mapa[]
  transaccion           transaccion[]
  ubicacion_tiempo_real ubicacion_tiempo_real[]

  @@index([disponible], map: "idx_producto_disponible")
  @@index([tipo], map: "idx_producto_tipo")
  @@index([id_ubicacion], map: "idx_producto_ubicacion")
  @@index([id_usuario], map: "idx_producto_usuario")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model publicidad {
  id_publicidad        Int                    @id @default(autoincrement())
  id_usuario           Int
  id_suscripcion       Int
  titulo               String                 @db.VarChar(100)
  descripcion          String?
  imagen_url           String?                @db.VarChar(300)
  url_destino          String?                @db.VarChar(300)
  fecha_inicio         DateTime               @db.Date
  fecha_fin            DateTime               @db.Date
  costo                Decimal                @default(0.00) @db.Decimal(10, 2)
  impresiones          Int                    @default(0)
  clics                Int                    @default(0)
  estado               String                 @default("pendiente") @db.VarChar(20)
  suscripcion          suscripcion            @relation(fields: [id_suscripcion], references: [id_suscripcion], onDelete: NoAction, onUpdate: NoAction)
  usuario              usuario                @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
  publicidad_producto  publicidad_producto[]
  publicidad_ubicacion publicidad_ubicacion[]

  @@index([estado], map: "idx_pub_estado")
  @@index([fecha_inicio, fecha_fin], map: "idx_pub_fechas")
  @@index([id_suscripcion], map: "idx_pub_suscripcion")
  @@index([id_usuario], map: "idx_pub_usuario")
}

model publicidad_producto {
  id_publicidad Int
  id_producto   Int
  producto      producto   @relation(fields: [id_producto], references: [id_producto], onDelete: Cascade, onUpdate: NoAction)
  publicidad    publicidad @relation(fields: [id_publicidad], references: [id_publicidad], onDelete: Cascade, onUpdate: NoAction)

  @@id([id_publicidad, id_producto])
}

model publicidad_ubicacion {
  id_pub_ubicacion Int        @id @default(autoincrement())
  id_publicidad    Int
  id_ubicacion     Int
  publicidad       publicidad @relation(fields: [id_publicidad], references: [id_publicidad], onDelete: Cascade, onUpdate: NoAction)
  ubicacion        ubicacion  @relation(fields: [id_ubicacion], references: [id_ubicacion], onDelete: NoAction, onUpdate: NoAction)

  @@unique([id_publicidad, id_ubicacion])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model rutas {
  id_ruta              Int                  @id @default(autoincrement())
  id_mapeador          Int
  origen_desc          String?              @db.VarChar(200)
  destino_desc         String?              @db.VarChar(200)
  origen_latitud       Decimal?             @db.Decimal(10, 6)
  origen_longitud      Decimal?             @db.Decimal(10, 6)
  destino_latitud      Decimal?             @db.Decimal(10, 6)
  destino_longitud     Decimal?             @db.Decimal(10, 6)
  calidad_carretera    String               @db.VarChar(20)
  obstaculos           String?
  tiempo_estimado_min  Int?
  distancia_km         Decimal?             @db.Decimal(8, 2)
  fecha_reporte        DateTime             @default(now()) @db.Timestamp(6)
  vigente              Boolean              @default(true)
  perfil_transportista perfil_transportista @relation(fields: [id_mapeador], references: [id_perfil], onDelete: NoAction, onUpdate: NoAction)

  @@index([calidad_carretera], map: "idx_rutas_calidad")
  @@index([fecha_reporte(sort: Desc)], map: "idx_rutas_fecha")
  @@index([id_mapeador], map: "idx_rutas_mapeador")
  @@index([vigente], map: "idx_rutas_vigente")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model snapshot_mapa {
  id_snapshot    Int       @id @default(autoincrement())
  tipo_entidad   String    @db.VarChar(20)
  id_usuario     Int?
  id_producto    Int?
  nombre_display String    @db.VarChar(150)
  descripcion    String?
  precio         Decimal?  @db.Decimal(12, 2)
  stock          Int?
  unidad_medida  String?   @db.VarChar(50)
  tipo_producto  String?   @db.VarChar(50)
  disponible     Boolean?
  latitud        Decimal   @db.Decimal(10, 6)
  longitud       Decimal   @db.Decimal(10, 6)
  pais           String?   @db.VarChar(100)
  departamento   String?   @db.VarChar(100)
  ciudad         String?   @db.VarChar(100)
  municipio      String?   @db.VarChar(100)
  fecha_snapshot DateTime  @default(now()) @db.Timestamp(6)
  activo         Boolean   @default(true)
  producto       producto? @relation(fields: [id_producto], references: [id_producto], onDelete: NoAction, onUpdate: NoAction)
  usuario        usuario?  @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)

  @@index([activo], map: "idx_snap_activo")
  @@index([ciudad], map: "idx_snap_ciudad")
  @@index([latitud, longitud], map: "idx_snap_coords")
  @@index([departamento], map: "idx_snap_departamento")
  @@index([fecha_snapshot(sort: Desc)], map: "idx_snap_fecha")
  @@index([tipo_entidad], map: "idx_snap_tipo")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model suscripcion {
  id_suscripcion         Int                   @id @default(autoincrement())
  nombre                 String                @unique @db.VarChar(20)
  alcance                String                @db.VarChar(20)
  mensualidad            Decimal               @default(0.00) @db.Decimal(10, 2)
  comision               Decimal               @db.Decimal(5, 2)
  incluye_publicidad     Boolean               @default(false)
  incluye_filtros        Boolean               @default(false)
  incluye_oferta_demanda Boolean               @default(false)
  pago_suscripcion       pago_suscripcion[]
  permiso_suscripcion    permiso_suscripcion[]
  publicidad             publicidad[]
  usuario                usuario[]
}

model tipo_usuario {
  id_tipo_usuario Int       @id @default(autoincrement())
  nombre          String    @unique @db.VarChar(50)
  descripcion     String?
  usuario         usuario[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model transaccion {
  id_transaccion                            Int                     @id @default(autoincrement())
  id_comprador                              Int
  id_vendedor                               Int
  id_producto                               Int
  id_necesidad_oferta                       Int?
  id_vehiculo                               Int?
  cantidad                                  Int
  precio_unitario                           Decimal                 @db.Decimal(12, 2)
  subtotal                                  Decimal                 @db.Decimal(12, 2)
  costo_transporte                          Decimal                 @default(0.00) @db.Decimal(12, 2)
  total                                     Decimal                 @db.Decimal(12, 2)
  comision_vendedor                         Decimal                 @default(0.00) @db.Decimal(10, 2)
  comision_transportista                    Decimal                 @default(0.00) @db.Decimal(10, 2)
  comision_total                            Decimal?                @default(dbgenerated("(comision_vendedor + comision_transportista)")) @db.Decimal(10, 2)
  fecha_transaccion                         DateTime                @default(now()) @db.Timestamp(6)
  estado                                    String                  @default("pendiente") @db.VarChar(20)
  notas                                     String?
  calificacion                              calificacion[]
  usuario_transaccion_id_compradorTousuario usuario                 @relation("transaccion_id_compradorTousuario", fields: [id_comprador], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
  necesidad_oferta                          necesidad_oferta?       @relation(fields: [id_necesidad_oferta], references: [id_necesidad_oferta], onDelete: NoAction, onUpdate: NoAction)
  producto                                  producto                @relation(fields: [id_producto], references: [id_producto], onDelete: NoAction, onUpdate: NoAction)
  vehiculo_transportista                    vehiculo_transportista? @relation(fields: [id_vehiculo], references: [id_vehiculo], onDelete: NoAction, onUpdate: NoAction)
  usuario_transaccion_id_vendedorTousuario  usuario                 @relation("transaccion_id_vendedorTousuario", fields: [id_vendedor], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)

  @@index([id_comprador], map: "idx_trans_comprador")
  @@index([estado], map: "idx_trans_estado")
  @@index([fecha_transaccion(sort: Desc)], map: "idx_trans_fecha")
  @@index([id_producto], map: "idx_trans_producto")
  @@index([id_vehiculo], map: "idx_trans_vehiculo")
  @@index([id_vendedor], map: "idx_trans_vendedor")
}

model ubicacion {
  id_ubicacion         Int                    @id @default(autoincrement())
  pais                 String                 @default("Colombia") @db.VarChar(100)
  departamento         String?                @db.VarChar(100)
  ciudad               String?                @db.VarChar(100)
  municipio            String?                @db.VarChar(100)
  latitud              Decimal?               @db.Decimal(10, 6)
  longitud             Decimal?               @db.Decimal(10, 6)
  producto             producto[]
  publicidad_ubicacion publicidad_ubicacion[]
  usuario              usuario[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model ubicacion_tiempo_real {
  id_utr                 Int                     @id @default(autoincrement())
  id_usuario             Int?
  id_vehiculo            Int?
  id_producto            Int?
  latitud                Decimal                 @db.Decimal(10, 6)
  longitud               Decimal                 @db.Decimal(10, 6)
  precision_m            Int?
  fecha_captura          DateTime                @default(now()) @db.Timestamp(6)
  fuente                 String?                 @default("app") @db.VarChar(30)
  producto               producto?               @relation(fields: [id_producto], references: [id_producto], onDelete: NoAction, onUpdate: NoAction)
  usuario                usuario?                @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
  vehiculo_transportista vehiculo_transportista? @relation(fields: [id_vehiculo], references: [id_vehiculo], onDelete: NoAction, onUpdate: NoAction)

  @@index([latitud, longitud], map: "idx_utr_coords")
  @@index([fecha_captura(sort: Desc)], map: "idx_utr_fecha")
  @@index([id_producto], map: "idx_utr_producto")
  @@index([id_usuario], map: "idx_utr_usuario")
  @@index([id_vehiculo], map: "idx_utr_vehiculo")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model usuario {
  id_usuario                                        Int                     @id @default(autoincrement())
  id_tipo_usuario                                   Int
  id_ubicacion                                      Int?
  id_suscripcion                                    Int?
  nombre                                            String                  @db.VarChar(100)
  email                                             String                  @unique @db.VarChar(100)
  contrasena                                        String                  @db.VarChar(255)
  telefono                                          String?                 @db.VarChar(20)
  direccion                                         String?                 @db.VarChar(150)
  fecha_registro                                    DateTime                @default(now()) @db.Timestamp(6)
  suscripcion_activa                                Boolean                 @default(false)
  estado                                            String                  @default("activo") @db.VarChar(20)
  calificacion_calificacion_id_calificadoTousuario  calificacion[]          @relation("calificacion_id_calificadoTousuario")
  calificacion_calificacion_id_calificadorTousuario calificacion[]          @relation("calificacion_id_calificadorTousuario")
  necesidad                                         necesidad[]
  notificacion                                      notificacion[]
  pago_suscripcion                                  pago_suscripcion[]
  perfil_transportista                              perfil_transportista?
  producto                                          producto[]
  publicidad                                        publicidad[]
  snapshot_mapa                                     snapshot_mapa[]
  transaccion_transaccion_id_compradorTousuario     transaccion[]           @relation("transaccion_id_compradorTousuario")
  transaccion_transaccion_id_vendedorTousuario      transaccion[]           @relation("transaccion_id_vendedorTousuario")
  ubicacion_tiempo_real                             ubicacion_tiempo_real[]
  suscripcion                                       suscripcion?            @relation(fields: [id_suscripcion], references: [id_suscripcion], onDelete: NoAction, onUpdate: NoAction)
  tipo_usuario                                      tipo_usuario            @relation(fields: [id_tipo_usuario], references: [id_tipo_usuario], onDelete: NoAction, onUpdate: NoAction)
  ubicacion                                         ubicacion?              @relation(fields: [id_ubicacion], references: [id_ubicacion], onDelete: NoAction, onUpdate: NoAction)

  @@index([estado], map: "idx_usuario_estado")
  @@index([suscripcion_activa], map: "idx_usuario_sus_activa")
  @@index([id_suscripcion], map: "idx_usuario_suscripcion")
  @@index([id_tipo_usuario], map: "idx_usuario_tipo")
  @@index([id_ubicacion], map: "idx_usuario_ubicacion")
}

model vehiculo_transportista {
  id_vehiculo           Int                     @id @default(autoincrement())
  id_perfil             Int
  tipo_vehiculo         String                  @db.VarChar(50)
  placa                 String?                 @unique @db.VarChar(20)
  capacidad_kg          Int?
  tarifa_km             Decimal?                @db.Decimal(10, 2)
  disponible            Boolean                 @default(true)
  transaccion           transaccion[]
  ubicacion_tiempo_real ubicacion_tiempo_real[]
  perfil_transportista  perfil_transportista    @relation(fields: [id_perfil], references: [id_perfil], onDelete: NoAction, onUpdate: NoAction)

  @@index([disponible], map: "idx_vehiculo_disponible")
  @@index([id_perfil], map: "idx_vehiculo_perfil")
}
